<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skywalkers Test Interface</title>
    <style>
        /* Eduquity Style Clean UI */
        body { margin: 0; font-family: 'Roboto', sans-serif; background: #f3f4f6; height: 100vh; display: flex; flex-direction: column; user-select: none; }
        
        /* Header */
        .header { background: #1e3a8a; color: white; height: 60px; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .logo { font-weight: bold; font-size: 1.2rem; }
        .timer { font-size: 1.2rem; font-weight: bold; background: #fbbf24; color: #000; padding: 5px 15px; border-radius: 4px; }

        /* Main Layout */
        .main { display: flex; flex: 1; overflow: hidden; }
        
        /* Question Area */
        .q-area { flex: 1; padding: 20px; overflow-y: auto; background: white; margin: 10px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); display: flex; flex-direction: column; }
        .q-info { border-bottom: 1px solid #e5e7eb; padding-bottom: 10px; margin-bottom: 15px; font-weight: bold; color: #1f2937; display: flex; justify-content: space-between; }
        .q-text { font-size: 1.1rem; color: #374151; line-height: 1.6; flex: 1; }
        
        .options { margin-top: 20px; }
        .opt-label { display: flex; align-items: center; padding: 12px; margin-bottom: 8px; border: 1px solid #d1d5db; border-radius: 6px; cursor: pointer; transition: 0.2s; }
        .opt-label:hover { background: #f9fafb; border-color: #3b82f6; }
        .opt-label input { margin-right: 15px; width: 18px; height: 18px; }

        /* Sidebar Palette */
        .sidebar { width: 280px; background: white; border-left: 1px solid #e5e7eb; display: flex; flex-direction: column; }
        .candidate { padding: 15px; background: #f3f4f6; text-align: center; border-bottom: 1px solid #e5e7eb; }
        .img-box { width: 60px; height: 60px; background: #cbd5e1; border-radius: 50%; margin: 0 auto 10px; }
        
        .palette { padding: 15px; flex: 1; overflow-y: auto; }
        .palette-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .p-btn { height: 35px; display: flex; align-items: center; justify-content: center; border: 1px solid #cbd5e1; border-radius: 4px; font-size: 0.9rem; cursor: pointer; background: white; }
        
        /* Eduquity Colors */
        .p-btn.answered { background: #10b981; color: white; border: none; } /* Green */
        .p-btn.not-answered { background: #ef4444; color: white; border: none; } /* Red */
        .p-btn.review { background: #8b5cf6; color: white; border: none; } /* Purple */
        .p-btn.current { border: 2px solid #2563eb; }

        /* Footer */
        .footer { height: 60px; background: white; border-top: 1px solid #e5e7eb; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; }
        .btn { padding: 10px 24px; border-radius: 4px; border: none; font-weight: 600; cursor: pointer; font-size: 0.9rem; }
        .btn-save { background: #2563eb; color: white; } /* Blue Save Next */
        .btn-save:hover { background: #1d4ed8; }
        .btn-clear { background: #f3f4f6; color: #374151; border: 1px solid #d1d5db; }
        .btn-review { background: #fbbf24; color: black; }
        
        .submit-container { padding: 10px; border-top: 1px solid #e5e7eb; }
        .btn-submit { width: 100%; background: #10b981; color: white; padding: 12px; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <div class="header">
        <div class="logo">Skywalkers Test Engine</div>
        <div class="timer" id="timer">00:00</div>
    </div>

    <div class="main">
        <div class="q-area">
            <div class="q-info">
                <span>Question <span id="q-num">1</span></span>
                <span style="color: #ef4444;">Marks: +2.0, -0.5</span>
            </div>
            <div class="q-text" id="q-text">Loading...</div>
            <div class="options" id="opt-container"></div>
        </div>

        <div class="sidebar">
            <div class="candidate">
                <div class="img-box"></div>
                <strong>John Doe</strong>
            </div>
            <div class="palette">
                <h4 style="margin-top:0;">Question Palette</h4>
                <div class="palette-grid" id="palette-box"></div>
            </div>
            <div class="submit-container">
                <button class="btn-submit" onclick="submitTest()">SUBMIT TEST</button>
            </div>
        </div>
    </div>

    <div class="footer">
        <div style="display:flex; gap:10px;">
            <button class="btn btn-clear" onclick="clearResp()">Clear Response</button>
            <button class="btn btn-review" onclick="markReview()">Mark for Review</button>
        </div>
        <button class="btn btn-save" onclick="saveNext()">Save & Next</button>
    </div>

    <script>
        // Sample Questions
        const questions = [
            { id: 1, text: "The Preamble of the Indian Constitution was borrowed from which country?", options: ["USA", "UK", "France", "Canada"], correct: 0 },
            { id: 2, text: "Which number follows the series: 2, 6, 12, 20, 30, ?", options: ["42", "40", "38", "44"], correct: 0 },
            { id: 3, text: "Who is the author of 'Train to Pakistan'?", options: ["R.K. Narayan", "Khushwant Singh", "Ruskin Bond", "Mulk Raj Anand"], correct: 1 }
        ];

        let currIdx = 0;
        let answers = new Array(questions.length).fill(null);
        let status = new Array(questions.length).fill('not-visited');
        let timer = 3600; // Default 60 mins

        // URL Params
        const params = new URLSearchParams(window.location.search);
        if(params.get('time')) timer = parseInt(params.get('time')) * 60;
        if(params.get('paper')) document.querySelector('.logo').innerText = params.get('paper');

        document.addEventListener('DOMContentLoaded', () => {
            loadQ(0); renderPalette(); startTimer();
        });

        function loadQ(idx) {
            currIdx = idx;
            document.getElementById('q-num').innerText = idx + 1;
            document.getElementById('q-text').innerText = questions[idx].text;
            const container = document.getElementById('opt-container');
            container.innerHTML = '';
            
            questions[idx].options.forEach((opt, i) => {
                const checked = answers[idx] === i ? 'checked' : '';
                container.innerHTML += `
                <label class="opt-label" onclick="selectOpt(${i})">
                    <input type="radio" name="opt" ${checked}> ${opt}
                </label>`;
            });

            if(status[idx] === 'not-visited') status[idx] = 'not-answered';
            renderPalette();
        }

        function selectOpt(i) {
            document.querySelectorAll('input[name="opt"]')[i].checked = true;
        }

        function saveNext() {
            const selected = document.querySelector('input[name="opt"]:checked');
            if(selected) {
                // Find index of selected radio
                const opts = document.getElementsByName('opt');
                for(let i=0; i<opts.length; i++) {
                    if(opts[i].checked) answers[currIdx] = i;
                }
                status[currIdx] = 'answered';
            } else {
                status[currIdx] = 'not-answered';
            }
            if(currIdx < questions.length - 1) loadQ(currIdx + 1);
        }

        function clearResp() {
            answers[currIdx] = null;
            status[currIdx] = 'not-answered';
            document.querySelectorAll('input[name="opt"]').forEach(el => el.checked = false);
            renderPalette();
        }

        function markReview() {
            status[currIdx] = 'review';
            const selected = document.querySelector('input[name="opt"]:checked');
            if(selected) {
                 const opts = document.getElementsByName('opt');
                 for(let i=0; i<opts.length; i++) if(opts[i].checked) answers[currIdx] = i;
            }
            if(currIdx < questions.length - 1) loadQ(currIdx + 1);
        }

        function renderPalette() {
            const box = document.getElementById('palette-box');
            box.innerHTML = '';
            status.forEach((st, i) => {
                let cls = 'p-btn ';
                if(st === 'answered') cls += 'answered';
                else if(st === 'review') cls += 'review';
                else if(st === 'not-answered') cls += 'not-answered';
                if(i === currIdx) cls += ' current';
                box.innerHTML += `<div class="${cls}" onclick="loadQ(${i})">${i+1}</div>`;
            });
        }

        function startTimer() {
            const el = document.getElementById('timer');
            setInterval(() => {
                if(timer <= 0) submitTest();
                else {
                    timer--;
                    let m = Math.floor(timer/60);
                    let s = timer%60;
                    el.innerText = `${m}:${s<10?'0':''}${s}`;
                }
            }, 1000);
        }

        function submitTest() {
            // Calculate Result
            let correct = 0, wrong = 0, skip = 0;
            answers.forEach((ans, i) => {
                if(ans === null) skip++;
                else if(ans === questions[i].correct) correct++;
                else wrong++;
            });
            let score = (correct * 2) - (wrong * 0.5);
            
            // Redirect to Analytics Page with Data
            const data = { score, correct, wrong, skip, accuracy: ((correct/(correct+wrong))*100 || 0).toFixed(1) };
            localStorage.setItem('testResult', JSON.stringify(data));
            window.location.href = 'analytics.html';
        }
    </script>
</body>
</html>
